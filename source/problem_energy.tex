%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newcommand{\formalAgentEnergyAvailable}[2]{
	\functionFormal{fae}
	{\setAgents{}{}}
	{\setRealNumbersUnit{}{}}
}
\newcommand{\functionAgentEnergyAvailable}[2]{
	\functionSignature{fae_{\varTime{}{}}}
	{\varAgent{}{}}
}


\subsection{Energy in the system}
\newcommand{\functionEnergyVariability}[2]{
\ifx \\#1\\
	\functionSignature{ev_{\varTime{}{}}}
	{\setAgents{}{}}
\else
	\functionSignature{ev_{\varTime{}{}}}{#1}
\fi
}
\newcommand{\functionEnergyAvailable}[2]{
\ifx \\#1\\
	\functionSignature{ea_{\varTime{}{}}}{\setAgents{}{}}
\else
	\functionSignature{ea_{\varTime{}{}}}{#1}
\fi
}
\todo[inline]{PROBLEM - ENERGY}
\subsubsection{Availability of energy}

The \textit{fractional agent energy} maps the an agent to its available energy, as a fraction of the batteries' maximum capacity, $\formalAgentEnergyAvailable{}{}$. We can then specify the \textit{energy availability}, as the sum of the fractional agent energy of all agents in a set $\setAgents{}{}$.
	\begin{equation}
		\functionEnergyAvailable{}{} 
		= \sum_{\forall \varAgent{}{} \in \setAgents{}{}} \functionAgentEnergyAvailable{\varAgent{i}{}}{}
	\end{equation}
and the \textit{energy variability} as the variance\footnote{Using the standard definition of variability of a discrete set $X$, $\sigma^2(X) = \frac{\sum (x_i - \bar{x})^2}{\funcSize{X}-1}$} of energy available to those agents.
	\begin{equation}     	
		\functionEnergyVariability{}{} 
		= \sigma^2(
			\lbrace \functionAgentEnergyAvailable{}{}
			\rbrace_{\forall \varAgent{}{} \in \setAgents{}{}}
		)
	\end{equation}

\newcommand{\functionTaskEnergyConsumption}[2]{
	\functionSignature{tec}
	{\varAtomicTask{}{}}
}
\todo[inline]{Define task consumption in terms of arc}
The \textit{task energy consumption} is the energy used by all agents in the system in executing an atomic task $\varAtomicTask{}{}$. Transmission energy, $\varTransmissionEnergy{}{}$, the power used by a node to  broadcast a message to allocate a task to another node, or reply with a task result. Receiver energy is the energy used by an agent to receives a message. Both transmission and receiving in an atomic task sequence of allocations involve all members of the arc twice, apart from the sink and sensing nodes which will only transmit and receive once. Note, we make the assumption that the energy of a broadcast of receipt of a message is independent of range. 
\begin{equation}
	\functionTaskEnergyConsumption{}{} 
	= 2\varTransmissionEnergy{}{} (\funcSize{\functionTaskArc{}{}}{} - 1)
	+ 2\varReceiverEnergy{}{} (2 \funcSize{\functionTaskArc{}{}}{} - 1)
\end{equation}
Although nodes would still use energy when in an idle power saving mode, or sleep mode, we disregard these for this formulation as we look to optimise the active node power usage only. There are other algorithms that can be used to optimise the cycling of power cell usage \cite{DUMMY}.
\subsubsection{Energy consumption}
\newcommand{\functionSystemEnergyConsumption}[2]{
	\functionSignature{sec}
	{\setCompositeTask{}{}}
}
\todo[inline]{Include orchestration energy?}
We can then go on to define the \textit{system energy consumption} as the energy used by all of the composite tasks $\setCompositeTask{}{}$ that are completed within a time period $\setTime{}{}$.
\todo[inline]{This isnt right wrt idle and sleeping, and how it works with tec}
\begin{equation}
	\functionSystemEnergyConsumption{}{} 
	= 
	\sum_{\forall \varCompositeTask{}{} \in \setCompositeTask{}{}}
	\sum_{\forall \varAtomicTask{}{} \in \varCompositeTask{}{}} \functionTaskEnergyConsumption{}{}
	+ \varIdleEnergy{}{} \sum \functionIdleRole{}{}
	+ \varSleepEnergy{}{} \sum \functionSleepRole{}{}
\end{equation}

